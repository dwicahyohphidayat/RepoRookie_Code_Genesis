apiVersion: skaffold/v4beta11
kind: Config
build:
  artifacts:
    - image: aitops/tools
      kaniko:
        buildContext:
          localDir: {}
        cache: {}        
        dockerfile: Dockerfile
  tagPolicy:
    gitCommit:
      prefix: test-
  cluster:
    dockerConfig:
      secretName: kaniko-registry-secret
    tolerations:
    - key: virtual-kubelet.io/provider
      operator: Equal
      value: alibabacloud
      effect: NoSchedule
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
              - virtual-kubelet-ap-southeast-5a
              - virtual-kubelet-ap-southeast-5b
manifests:
  rawYaml:
    - ./k8s/*
deploy:
  kubectl: {}
